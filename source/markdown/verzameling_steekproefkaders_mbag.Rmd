---
title: "Uitschrijven steekproefkaders MBAG"
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# Set up
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE)
knitr::opts_knit$set(
  root.dir = here::here())
```

```{r}
# Packages
library(tidyverse)
library(sf)
library(targets)

# Conflicting packages
conflicted::conflicts_prefer(dplyr::filter)
conflicted::conflicts_prefer(dplyr::select)
conflicted::conflicts_prefer(dplyr::lag)

# Source
mbag_dir <- here::here()
data_path <- file.path(mbag_dir, "data", "steekproefkaders")
```

# Doel

We willen voor het MBAG project een duidelijk overzicht van het steekproefkader en de steekproef.
Hiervoor schrijven we voor 4 (groepen van) bestanden weg (als CSV-bestanden):

1.  steekproefkader

2.  gewichten steekproefkader per landbouwregio

3.  steekproef

4.  finale steekproef na manuele controle (punten die effectief zijn geteld)

# Data selectie en preparatie
## Leemstreek & Zandleemstreek

Meetnetontwerp voor deze regio's maakte deel uit van de MAS-pilootstudie.
Data selectie en preparatie voor deze regio's werd reeds gedaan in dat project.
De code vind je in [deze repository](https://github.com/inbo/mas-piloot).
We lezen de CSV-bestanden in.

```{r}
# Load sampling frame
steekproefkader_mbag_piloot <- read.csv(
  file.path(data_path, "steekproefkader_mbag_piloot.csv"))

# Load samples
steekproef_mbag_piloot <- read.csv(
  file.path(data_path, "steekproef_mbag_piloot.csv"))

# Load final samples
steekproef_avimap_mbag_piloot <- read.csv(
  file.path(data_path, "steekproef_avimap_mbag_piloot.csv"))
```

## Kempen, Polders & Zandstreek

```{r}
target_store_za_kp_po <- here::here(
  "source", "targets", "mas_steekproef_za_kp_po", "_targets")
```

Inlezen en preparatie steekproefkader.

```{r}
steekproefkader_za_kp_po_raw <- tar_read(
  steekproefkader_finaal,
  store = target_store_za_kp_po) %>%
  reduce(rbind)

# Prepare final dataframe
steekproefkader_za_kp_po <- steekproefkader_za_kp_po_raw %>%
  mutate(sbp = ifelse(is_sbp, "binnen", "buiten"),
         crs = 31370,
         x_coord = st_coordinates(geometry)[,1],
         y_coord = st_coordinates(geometry)[,2]) %>%
  select(pointid, regio = Naam, area_prop_sb, openheid_klasse, sbp, x_coord,
         y_coord, crs) %>%
  filter(openheid_klasse %in% c("OL", "HOL")) %>%
  st_drop_geometry()
```



## Weidestreek

```{r}
target_store_weidestreek <- here::here(
  "source", "targets", "mas_steekproef_weidestreek", "_targets")
```

Inlezen en preparatie steekproefkader.

```{r}
steekproefkader_weidestreek_raw <- tar_read(
  steekproefkader_finaal,
  store = target_store_weidestreek) %>%
  reduce(rbind)

# Prepare final dataframe
steekproefkader_weidestreek <- steekproefkader_weidestreek_raw %>%
  mutate(Naam = "Weidestreek",
         sbp = ifelse(is_sbp, "binnen", "buiten"),
         crs = 31370,
         x_coord = st_coordinates(geometry)[,1],
         y_coord = st_coordinates(geometry)[,2]) %>%
  select(pointid, regio = Naam, area_prop_sb, openheid_klasse, sbp, x_coord,
         y_coord, crs) %>%
  filter(openheid_klasse %in% c("OL", "HOL")) %>%
  st_drop_geometry()
```



# Uitschrijven datasets
## Steekproefkader

Dit is een CSV-bestand van alle steekproefkaders.

## Gewichten steekproefkader

Dit zijn aparte CSV-bestanden voor elke regio.

## Steekproef

Dit is een CSV-bestand van alle steekproeven.

## Finale steekproef na manuele controle

Dit is een CSV-bestand van alle finale telpunten.
