---
title: "Controle data en data preparatie pipeline"
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# set up
library(knitr)
opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  out.width = "100%"
)
opts_knit$set(root.dir = here::here())
```

```{r}
# packages
library(tidyverse)
library(sf)
library(mapview)
library(targets)

# Conflicts
conflicted::conflicts_prefer(dplyr::filter)
conflicted::conflicts_prefer(dplyr::select)

# Source
source(here::here("source", "R", "tar_read_sf.R"))

# Paths
mbag_dir <- here::here()
targets_store <- here::here("source", "targets", "data_preparation", "_targets")
```

# Doel

Data cleaning en preparatie verloopt via een targets pipeline waarbij verschillende stappen elkaar opvolgen.

```{r}
tar_visnetwork(script = paste0(targets_store, ".R"),
               store = targets_store)
```

In deze markdown controleren we 

1. Of deze pipeline de verwachte stappen correct doorloopt
2. De finale data op het einde van de pipeline voor onverwachte zaken, uitschieters ...

We doen dit voor de data van 2018-2024.

# Data preparatie workflow
## Amersfoord naar Lambert coordinaten

```{r}
mas_counts_sovon <- tar_read_sf("mas_counts_sovon", targets_store)
crs_pipeline <- tar_read_sf("crs_pipeline", targets_store)
  
mapview(mas_counts_sovon) +
  mapview(tar_read(crs_pipeline, store = targets_store), col.regions = "red")
```

